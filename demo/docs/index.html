<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Documentation | Meridian Web SDK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="../shared.css">
  <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>
  <script src="../shared.js"></script>
  <script src="https://unpkg.com/highlightjs@9.10.0/highlight.pack.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/highlightjs@9.10.0/styles/atom-one-dark.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>
    <a href="#">Meridian Web SDK Documentation</a>
  </h1>

  <h2 id="overview">
    <a href="#overview">Overview</a>
  </h2>

  <p>
    Before you can use the Meridian Web SDK, you'll need to obtain a
    <strong class="highlighter">read-only</strong> API token from the Meridian Editor.
    <a target="_blank" href="https://docs.meridianapps.com/article/374-token-authentication">Go here to learn more about Meridian's token authentication.</a>
  </p>

  <pre><code class="js">
    MeridianSDK.init({
      api: MeridianSDK.createAPI({
        environment: "production",
        token: "Insert your read-only token here"
      })
    });

    const element = document.getElementById("meridian-map");
    const map = MeridianSDK.createMap(element, {
      locationID: "Insert your location ID here",
      floorID: "Insert your floor ID here",
      placemarks: { all: true },
      tags: { all: false }
    });

    // Later on...
    map.update({
      placemarks: { all: false },
      tags: { all: true }
    });
  </code></pre>

  <p>
    You can find the location and floor IDs for a specific map by opening that map in the Meridian Editor. The URL for the map
    page contains the IDs:
  </p>

  <p class="font-sans flex flex-wrap">
    <span>https://</span>
    <span>edit.meridianapps.com</span>
    <span>/apps/</span>
    <span>
      <strong class="highlighter">location ID</strong>
    </span>
    <span>/versions/1/maps/</span>
    <span>
      <strong class="highlighter">floor ID</strong>
    </span>
    <span>/placemarks</span>
  </p>


  <h2 id="init">
    <a href="#init">MeridianSDK<wbr>.init(<wbr>options<wbr>)</a>
  </h2>

  <pre><code class="js">
    MeridianSDK.init({
      api: MeridianSDK.createAPI({
        environment: "production",
        token: "Insert your read-only token here"
      })
    });
  </code></pre>

  <ul>
    <li>
      <span class="parameter">options:</span> an object with any of the following keys:
      <ul>
        <li>
          <span class="parameter">api:</span> the object returned from
          <code>MeridianSDK.createAPI</code>
        </li>
      </ul>
    </li>
  </ul>

  <p>
    Calling
    <code>init</code> is optional. Instead, you can pass the API instance directly to
    <a href="#createMap">createMap</a>.
  </p>

  <pre><code class="js">
    var apiOrg1 = MeridianSDK.createAPI({ token: "Insert Org 1 token here" });
    var apiOrg2 = MeridianSDK.createAPI({ token: "Insert Org 2 token here" });
    MeridianSDK.createMap(elementOrg1, {
      api: apiCustomer1,
      locationID: "Insert Org 1 location ID here",
      floorID: "Insert Org 1 floor ID here",
    });
    MeridianSDK.createMap(elementOrg2, {
      api: apiCustomer2,
      locationID: "Insert Org 2 location ID here",
      floorID: "Insert Org 2 floor ID here",
    });
  </code></pre>

  <p>
    To find your organization ID, in the Meridian Editor sidebar menu, click Organization, and then find the ID in the Organization
    Details section. You can get it from the URL too:
  </p>

  <p class="font-sans flex flex-wrap">
    <span>https://</span>
    <span>edit.meridianapps.com</span>
    <span>/w/organization/</span>
    <span>
      <strong class="highlighter">organization ID</strong>
    </span>
  </p>

  <h2 id="createMap">
    <a href="#createMap">MeridianSDK<wbr>.createMap(<wbr>element, <wbr>options<wbr>)</a>
  </h2>

  <pre><code class="js">
    const element = document.getElementById("meridian-map");
    const map = MeridianSDK.createMap(element, {
      locationID: "Insert your location ID here",
      floorID: "Insert your floor ID here",
      tags: { all: false },
      placemarks: { all: true }
    });

    // Toggle tags/placemarks after 10 seconds
    setTimeout(() => {
      map.update({
        tags: { all: true },
        placemarks: { all: false }
      });
    }, 10000)
  </code></pre>

  <ul>
    <li>
      <span class="parameter">element:</span> the DOM element where the map should be rendered
    </li>
    <li>
      <span class="parameter">options:</span> an object with any of the following keys:
      <ul>
        <li>
          <span class="parameter">locationID:</span> (required)
        </li>
        <li>
          <span class="parameter">mapID:</span> (required) the floor ID
        </li>
        <li>
          <span class="parameter">width:</span> (default =
          <code>"100%"</code>) map width as a CSS length string
        </li>
        <li>
          <span class="parameter">height:</span> (default =
          <code>"400px"</code>) map height as a CSS length string
        </li>
        <li>
          <span class="parameter">showFloorsControl:</span> (default =
          <code>true</code>) show UI control to allow switching floors
        </li>
        <li>
          <span class="parameter">showTagsControl:</span> (default =
          <code>true</code>) show UI control to allow browsing tags
        </li>
        <li>
          <span class="parameter">api:</span> (default = the
          <code>api</code> object passed to
          <a href="#init">init</a>) the API object returned by
          <a href="#createAPI">createAPI</a>
        </li>
        <li>
          <span class="parameter">tags:</span> (default =
          <code>{}</code>) an object with any of the following keys:
          <ul>
            <li>
              <span class="parameter">all:</span> (default =
              <code>false</code>) show all Tags when true
            </li>
            <li>
              <span class="parameter">ids:</span> (default =
              <code>[]</code>) show all Tags which match the IDs in the list
            </li>
            <li>
              <span class="parameter">labels:</span> (default =
              <code>[]</code>) show all Tags which have any of these named labels
            </li>
            <li>
              <span class="parameter">showControlTags:</span> (default =
              <code>false</code>) control tags are shown when true
            </li>
            <li>
              <span class="parameter">disabled:</span> (default =
              <code>false</code>) disable clicking on Tags when true
            </li>
          </ul>
        </li>
        <li>
          <span class="parameter">placemarks:</span> (default =
          <code>{}</code>) an object with any of the following keys:
          <ul>
            <li>
              <span class="parameter">all:</span> (default =
              <code>false</code>) show all placemarks when true
            </li>
            <li>
              <span class="parameter">ids:</span> (default =
              <code>[]</code>) show all placemarks which match the IDs in the list
            </li>
            <li>
              <span class="parameter">types:</span> (default =
              <code>[]</code>) show all placemarks matching the named types in the list
            </li>
            <li>
              <span class="parameter">disabled:</span> (default =
              <code>false</code>) disable clicking placemarks when true
            </li>
          </ul>
        </li>
        <!-- TODO: Revisit the click handler API eventually -->
        <!--
        <li>
          <span class="parameter">onMarkerClick(marker):</span> (optional) callback function called with the map marker (tag/placemark) the user clicks
          on
        </li>
        <li>
          <span class="parameter">onMapClick():</span> (optional) callback function called when the user clicks on the map background
        </li>
        -->
        <li>
          <span class="parameter">onTagsUpdate(tagsByID):</span> (optional) callback function called whenever any Tags are updated, receiving all
          Tags in an object keyed by their IDs (capitalized MAC addresses without colons)
        </li>
        <li>
          <span class="parameter">onFloorsUpdate(floorsByBuilding):</span> (optional) callback function called when the Floors are loaded, receiving
          all Floors in an object keyed by their building names
        </li>
        <li>
          <span class="parameter">shouldMapPanZoom(event):</span>
          (optional) callback function called when the user attempts to pan or zoom the map

          <p>
            Return
            <code>true</code> to allow the pan or zoom action,
            <code>false</code> to prevent it. This should be used to require holding down a modifier key like
            <code>alt</code> or require at least two fingers to pan the map, which is useful for areas where the map could easily interrupt
            scrolling behavior. Use the function
            <code>MeridianSDK.restrictedPanZoom</code> if you want this behavior, which is implemented as follows:
          </p>

          <pre><code class="js">
            function restrictedPanZoom(event) {
              if (event.type === "wheel" && !event.altKey) {
                return false;
              } else if (event.type === "touchstart") {
                return event.touches.length >= 2;
              }
              return true;
            }
          </code></pre>

          <p>
            You should handle all three of these event types to manage pan and zoom across various devices:
            <code>mousedown</code>,
            <code>wheel</code>,
            <code>touchstart</code>.
          </p>
        </li>
      </ul>
    </li>
  </ul>

  <p>Returns an API object with the following properties:</p>

  <ul>
    <li>
      <span class="parameter">update(options):</span> a method that merged the initial options and the options passed here and updates the map
    </li>
    <li>
      <span class="parameter">zoomToDefault():</span> a method to zoom the map to the initial zoom level and position
    </li>
    <li>
      <span class="parameter">zoomToPoint(options):</span> a method to pan and zoom to a specific point on the map, takes an object with
      <code>x</code>,
      <code>y</code>, and
      <code>scale</code>, which are all numbers

      <pre><code class="js">
        map.zoomToPoint({
          x: tag.x,
          y: tag.y,
          scale: 2
        });
      </code></pre>
    </li>
  </ul>

  <h2 id="createAPI">
    <a href="#createAPI">MeridianSDK<wbr>.createAPI(<wbr>options<wbr>)</a>
  </h2>

  <pre><code class="js">
    const api = MeridianSDK.createAPI({
      environment: "production",
      token: "Insert your read-only token here"
    });
  </code></pre>

  <ul>
    <li>
      <span class="parameter">options:</span> an object with any of the following keys:
      <ul>
        <li>
          <span class="parameter">environment:</span> defaults to
          <code>"production"</code>; valid values are any of the following:
          <code>"production"</code>
          <!-- TODO: Should we mention staging here? And eventually this needs to include eu in the list -->
        </li>
        <li>
          <span class="parameter">token:</span> a read-only API token obtained from the Meridian Editor
        </li>
      </ul>
    </li>
  </ul>

  <p>Returns an API object with the following properties:</p>

  <ul>
    <li>
      <span class="parameter">token:</span> the API token</li>
    <li>
      <span class="parameter">environment:</span> the API environment</li>
    <li>
      <span class="parameter">axios:</span> an instance of
      <a target="_blank" href="https://github.com/axios/axios">axios</a> configured with a base URL for the current environment and including an HTTP header with the token
    </li>
    <li>
      <span class="parameter">openStream(options):</span> a function to
      <a href="#api.openStream">open a streaming connection</a> for real time tag updates
    </li>
  </ul>

  <h2 id="api.openStream">
    <a href="#api.openStream">api<wbr>.openStream(<wbr>options)</a>
  </h2>

  <pre><code class="js">
    const api = MeridianSDK.createAPI({
      environment: "production",
      token: "Insert your read-only token here"
    });

    const connection = api.openStream({
      locationID: "Insert your location ID here",
      floorID: "Insert your floor ID here",
      onInitialTags: tagArray => {
        console.log(tagArray);
      },
      onTagDisappear: tag => {
        console.log(tag);
      },
      onTagUpdate: tag => {
        console.log(tag);
      },
      onClose: () => {
        console.log("Closing!");
      },
      onException: err => {
        console.log("An error occurred:", err)
      }
    });

    // Close connection after 10 seconds
    setTimeout(() => {
      connection.close();
    }, 10000);
  </code></pre>

  <ul>
    <li>
      <span class="parameter">options:</span> an object with any of the following keys:
      <ul>
        <li>
          <span class="parameter">locationID:</span> the location ID
        </li>
        <li>
          <span class="parameter">floorID:</span> the floor ID
        </li>
        <li>
          <span class="parameter">onInitialTags:</span> an optional callback function called with an array of Tag data after the stream connection
          is successful
        </li>
        <li>
          <span class="parameter">onTagUpdate:</span> an optional callback function called with a single Tag's data when it reports its position
        </li>
        <li>
          <span class="parameter">onTagDisappear:</span> an optional callback function called with a single Tag data when it exits its current floor
        </li>
        <li>
          <span class="parameter">onClose:</span> an optional callback function called when the stream is closed
        </li>
        <li>
          <span class="parameter">onException:</span> an optional callback function called when the stream reports an error
        </li>
      </ul>
    </li>
  </ul>

  <p>Returns an API object with the following properties:</p>

  <ul>
    <li>
      <span class="parameter">close():</span> a method to close the stream
    </li>
  </ul>

  <script>
    (function () {
      function trimIndent(str) {
        var match = str.match(/^[ \t]*(?=\S)/gm);
        if (!match) {
          return str;
        }
        var lengths = match.map(function (x) {
          return x.length;
        });
        var indent = Math.min.apply(Math, lengths);
        var re = new RegExp("^[ \\t]{" + indent + "}", "gm");
        var s = indent > 0 ? str.replace(re, "") : str;
        return s.trim();
      }
      $("pre code").each(function (i, elem) {
        var $elem = $(elem);
        $elem.text(trimIndent($elem.text()));
        hljs.highlightBlock(elem);
        $elem.find(".hljs-string").each(function (j, str) {
          var $str = $(str);
          var re = /.insert.*here./i;
          if (re.test($str.text())) {
            $str.addClass("user-input");
          }
        });
      })
    })();
  </script>

</body>

</html>
